# 轮询函数

## 使用
```js
const poll = new Poll({
    task: (resolve, reject) => {//运行的轮询函数  若条件通过 则需要返回 true 反之 返回 false
        setTimeout(() => {
            const num = Math.random()
            console.log('num 的值是：', num);
            if (num > 0.5) resolve(true)
            else resolve(false)
        }, 1000);
    },
    success(res) { console.log('轮询成功'); },//成功的回调函数
    fail(res) { console.log('轮询失败'); },//失败的回调函数
    wait: 500,//每次轮询的间隔时间
    limitTimes: 3,//最大轮询次数 超过结束轮询
})

```


## 源码
```js
class Poll {
    constructor({ task, wait, success, fail, limitTimes }) {
        this.task = _ => new Promise(task)
        this.wait = wait
        this.limitTimes = limitTimes
        this.timer = ''
        this.success = success
        this.fail = fail
        this.currentTimes = 0
        this.run()
    }

    async run() {
        this.currentTimes++
        const res = await this.task()
        if (res) {
            this.success(res)
        } else {
            if (this.currentTimes === this.limitTimes) { //若最后一次轮询 还是失败 则执行失败回调
                this.fail(res)
            } else {
                clearTimeout(this.timer)
                this.timer = setTimeout(() => {
                    this.run()
                }, this.wait);
            }
        }
    }
}
```
